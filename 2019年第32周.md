# 2019年第32周（8.5-8.11）

## DNN-Based Prediction Model for Spatio-Temporal Data

## Co-Prediction of Multiple Transportation Demands Based on Deep Spatio-Temporal Neural Network

深度卷积自编码器 获得城市交通的多层bases

$$\tag{6} Z^L_t=f_{en}(X^L_t*W_{en}+b_{en})$$
$$\tag{7} \hat X^L_t=f_{de}(Z^L_t*W_{de}+b_{de})$$

等式6描述编码器，特征图$Z^L_t$是编码器的输出。$\vec{W}_{en}$，$\vec{b}_{en}$是整个编码器的可训练参数。编码器的输出作为解码器的输入。  
等式7模型的解码器，和编码器是对称的结构。  
$\hat X^L_t$是$X^L_t$的重新结构化，是解码器的输出。  
编码器与解码器的深度都是R。  

#### 3.1.2 CNN Demand Model

CNN层与反CNN层定义如下：

$$\tag{8} Z^{L,r}_t=\delta_{en}(Z^{L,r-1}_t*W^{r-1}_{en}+b^{r-1}_{en})$$
$$\tag{9} Z^{L,r-1}_t=\delta_{de}(Z^{L,r}_t*W^r_{de}+b^r_{de})$$

$r$是层数，当$r=1$，$Z^{L,0}_t=X^L_t$，然后等式(8)和等式(9)就退化为等式(6)和等式(7)。  
等式(8)描述CNN，$Z^{r,L}_t$是第r层CNN的输出。  
$W^{r-1}_X$与$b^{r-1}_X$是可训练参数。  
等式(9)代表反CNN的第r层。  
对每个时间间隔t，将整个城市视为$I \times J$地图通道，$x^{B,p,L}_t \in \R^{1\times I \times J}(x^{B,d,L}_t,x^{C,p,l}_t,etc.)$。  
经过编码获得$I' \times J'$的地图，将所有的编码结果输入LSTM。

### 3.2 Heterogeneous LSTM Neural Network

给定时间间隔$t- \tau +1,t-\tau+2,...,t$的历史系数，预测$t+1$的空间demand bases系数。  
基础RNN定义如下：

$$\tag{10} s_t=W_s[s_{t-1},Z_t]+b_s$$

将当前输入$Z_t$与前状态$s_{t-1}$结合来更新隐藏态$s_t$。  
$W_s$代表权重，$b_s$代表偏倚。  
RNN有多个隐藏态，分别代表自行车上下车以及出租的上下车，$s_t^{B,p},s_t^{B,d},s_t^{C,p},s_t^{C,d}$。  
在时间序列预测问题中，RNN由于梯度爆炸和消失而逐渐被弃用，转而使用LSTM。  
基础LSTM使用时间序列$\{Z_{t-\tau+1},Z_{t-\tau+2},...,Z_t\}$作为输入，但是无法预测异构时间序列的$t+1$系数。__因此本文提出异构LSTM模型__。  
$$
\tag{14}
\begin{gathered}
a_t=\sigma(W_{\alpha}[Z^{B,p}_t,Z^{B,d}_t,Z^{C,p}_t,Z^{C,d}_t,s_{t-1}]+b_{\alpha})\\
\phi_t=\sigma(W_{\phi}[Z^{B,p}_t,Z^{B,d}_t,Z^{C,p}_t,Z^{C,d}_t,s_{t-1}]+b_{\phi})\\
u_t=\sigma(W_u[Z^{B,p}_t,Z^{B,d}_t,Z^{C,p}_t,Z^{C,d}_t,s_{t-1}]+b_{u})\\
\tilde{v}_t=\tanh(W_v[Z^{B,p}_t,Z^{B,d}_t,Z^{C,p}_t,Z^{C,d}_t,s_{t-1}]+b_v)\\
v_t=f_t*v_{t-1}+\alpha_t*\tilde{v}_t\\
s_t=u_t*\tanh(v_t)
\end{gathered}
$$

LSTM将$Z^{B,p}_t,Z^{B,d}_t,Z^{C,p}_t,Z^{C,d}_t,s_{t-1},v_{t-1}$作为输入。$a_t$是输入门，$\phi_t$是遗忘门，帮助前cell state $v_{t-1}$遗忘一些信息。$u_t$控制LSTM在时间间隔t的输出。*代表阿达玛积。  
异构序列完全相互作用，相互增强。

### 3.3 融合与共同预测

充分考虑天气等外在因素。枚举类型使用ont-hot进行编码。编码后，使用全连接层提取外部因素的关联与表征。  
异构LSTM的输出与全连接层串联：

$$\tag{15} Y'_{t+1}=\phi(s_t\oplus e'_t)$$

$Y'_{t+1}$是串联结果，$s_t$是LSTM的输出，$e'_t$是外部因素表征，$\phi$全连接层，$Y'_{t+1}$能分解为多个输出。  
解码器解码$Y'_{t+1}$得到需求图$\hat{Y}_{t+1}$，也是预测结果。  
解码器不可训练，预测其他类别，需要使用预训练卷积自编码器的参数。  
模型使用预测需求与真实需求的最小均方差训练。  
分别预测四种需求。

## 4 实验

使用现实数据评估方法。

### 4.1 数据集

### 4.2 基准线

将对比方法，调整关键超参数，确保有最好的表现。  
选择一些典型经典的机器学习方法作为基准线。

* __HA__
* __ARIMA__
* __LR__
* __SVR__
* __XGBoost__

基于神经网络的方法：

* __Multiple layer perceptron__
* __ConvLSTM__
* __DeepST__
* __ST-ResNet__

### 4.3 评估度量标准

均方根误差与皮尔逊相关系数评估算法。

### 4.4 实验环境

训练深度卷积自编码器的数据集是训练异构LSTM的数据集的8倍。  
对异构LSTM的数据集时间做多次偏移，获得足够大的数据集训练深度卷积自编码器。  
好处：

* 两个数据集同源，确保模型的准确性和鲁棒性
* 交通数据并非严格的周期性
* 增加多样性，以获得空间需求bases的不变形

所有地点的需求被规范化为[0,1]。（后续即为相关参数的设置）。

### 4.5 结果

#### 4.5.1 与不同基准值比较

所有基准值运行十次，取平均值进行比较。  
我们的模型拥有最佳的性能和最低的RMSE。  
经典机器学习方法比深度学习方法性能相对较差。在深度学习方法中，展现了CNN在解决这类问题的强大能力，DeepST、ST-ResNet是当前最佳的方法。

#### 方差比较

使用箱型图比较结果。我们的方法拥有所有方法中的最佳性能，以及深度学习方法中的最小方差。

#### 4.5.3 与CoST-Net变体的比较

我们的方法有4个输入通道，使用的通道越多，结果越佳。  
单通道输入的表现比所有基准值表现都要好，除了XGBoost。

#### 4.5.4 不同时间点的表现

在4个特定的时间点下，将我们的方法与基准值比较。

## 5 相关工作

早期工作主要试图预测特定时间的地点的交通量。使用数据挖掘技巧和经验统计方法。  
ARIMA是受欢迎的经典方法，他人的工作使用进行空间需求预测，作出改进做自行车需求预测。  
Ye等人提出两种有效的方法，针对多用户移动序列推荐问题。  
这些方法针对特定问题，很难用于同时的时空关联问题。  

## 6 结论

CoST-Net包含3个模块：

1. 表征学习模块。将空间需求分布编码成隐藏空间需求bases的联合
2. 异构学习模块。将不同交通需求状态融合，状态动力学建模。
3. 集成模块。包含环境因素，展现多运输系统需求预测。

空间分解表征、多交通需求异构融合使CoST-Net有优异的性能。提供微观和宏观视角预测需求。未来将公交车和铁路加入考虑。
